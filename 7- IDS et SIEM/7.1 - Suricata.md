
# Intrusion Detection Systems (IDS) - Suricata
> Suricata est un système de détection d'intrusion, un système de prévention d'intrusion et un outil d'analyse de réseau open source.

> Un système de détection d'intrusion (IDS) est une application qui surveille l'activité du système et alerte en cas d'intrusions potentielles. Les technologies IDS aident les organisations à surveiller l'activité de leurs systèmes et réseaux afin d'identifier les signes d'activité malveillante.
## Aperçu
Il existe trois façons d'utiliser Suricata :

1. Système de détection d'intrusion`(IDS)` : il surveille le trafic réseau et alerte en cas d'activités suspectes et d'intrusions. Concrètement, il peut s'agir d'un système de détection d'intrusion hôte permettant de surveiller l'activité système et réseau d'un ordinateur.
2. Système de prévention des intrusions`(IPS)` : détecte et bloque les activités et le trafic malveillants. Il nécessite une configuration supplémentaire, comme l’activation du mode IPS.
3. Surveillance de la sécurité réseau`(NSM)` : Générer et sauvegarder les journaux réseau pertinents (trafic réseau en temps réel, fichiers de capture de paquets existants, captures de paquets complètes ou conditionnelles). Ceci est utile pour les analyses forensiques, la réponse aux incidents et le test des signatures.

Suricata utilise l'analyse de signatures, une méthode de détection permettant d'identifier les événements d'intérêt. Les signatures sont composées de trois éléments :

1. Action : Premier élément d’une signature. Elle décrit l’action à entreprendre si l’activité du réseau ou du système correspond à la signature. Exemples : alerte, autorisation, blocage ou rejet.
2. En-tête : L’en-tête comprend des informations sur le trafic réseau telles que les adresses IP source et de destination, les ports source et de destination, le protocole et le sens du trafic.
3. Options de règles : Les options de règles vous offrent différentes possibilités pour personnaliser les signatures.

![chrome_KkKCDwVmK9](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/255a7ff5-5db0-48f7-934a-a816885e5b45)

## Analysez les alertes, les journaux et les règles avec Suricata

Dans ce scénario, vous êtes analyste de sécurité et devez surveiller le trafic sur le réseau de votre employeur. Vous devrez configurer Suricata et l'utiliser pour déclencher des alertes.

Voici comment procéder : vous explorerez d’abord les règles personnalisées dans Suricata. Ensuite, vous exécuterez Suricata avec une règle personnalisée pour la déclencher et examinerez les journaux de sortie dans le fichier fast.log. Enfin, vous analyserez les informations supplémentaires générées par Suricata dans le fichier journal standard eve.json.

Pour les tests que vous effectuerez dans le cadre de cette activité de laboratoire, un fichier sample.pcap et un fichier custom.rules vous ont été fournis. Ils se trouvent dans votre dossier personnel.

Définissons les fichiers :

1. Ce `sample.pcapfichier` est un fichier de capture de paquets contenant un exemple de données de trafic réseau, que vous utiliserez pour tester les règles Suricata. Cela vous permettra de simuler et de répéter l'exercice de surveillance du trafic réseau.

2. Ce `custom.rulesfichier` contient une règle personnalisée qui s'applique au démarrage de l'activité de laboratoire. Vous ajouterez des règles à ce fichier et les appliquerez aux données de trafic réseau contenues dans le fichier sample.pcap.

3. Le `fast.logfichier` fast.log contient les alertes générées par Suricata. Initialement vide, il est ajouté à chaque test d'une règle (ou d'un ensemble de règles) sur les données de trafic réseau d'exemple. Dès que toutes les conditions d'une règle sont remplies, Suricata y ajoute une nouvelle ligne d'alerte. Le fichier fast.log se trouve dans le répertoire /var/log/suricata après l'exécution de Suricata. Ce format est obsolète et n'est pas recommandé pour la réponse aux incidents ni la recherche de menaces. Il peut toutefois servir à des vérifications rapides ou à des tâches d'assurance qualité.

4. Le `eve.json` fichier est le journal principal, standard et par défaut des événements générés par Suricata. Il contient des informations détaillées sur les alertes déclenchées, ainsi que sur d'autres événements de télémétrie réseau, au format JSON. Le fichier eve.json est généré lors de l'exécution de Suricata et se trouve également dans le `/var/log/suricatarépertoire`.

Lorsque vous créez une nouvelle règle, vous devez la tester pour vérifier son bon fonctionnement. Le fichier fast.log vous permet de comparer rapidement le nombre d'alertes générées à chaque exécution de Suricata pour tester une signature par rapport au `sample.pcap` fichier.

## Attente
* Créez des règles personnalisées et exécutez-les dans Suricata
* Surveillez le trafic capturé dans un fichier de capture de paquets
* Examinez le fichier fast.log et eve.jsonla sortie

## Étape par étape
Examiner une règle personnalisée dans Suricata.

![chrome_wQ9p61CyjX](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/2c776e7c-9af7-415e-bdfd-9c859b3c6a05)

```
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"GET on wire"; flow:established,to_server; content:"GET"; http_method; sid:12345; rev:3;)
```

* Action `Alert` : Configure le système pour qu’il génère une alerte en cas de trafic réseau sélectionné. Le système de détection d’intrusion (IDS) analysera les paquets de trafic et enverra une alerte si une correspondance est établie.

* En-tête `http` : La règle s'applique uniquement au trafic HTTP. La flèche indique le sens du trafic, de $HOME_NET vers l'adresse IP de destination $EXTERNAL_NET. Dans ce cas, $HOME_NET est une variable Suricata définie dans `/etc/suricata/suricata/yaml` définitions de règles. $HOME_NET est défini comme le 172.21.224/0/20sous-réseau.

* Options de règle `Rule` : Personnalisez les signatures avec des paramètres supplémentaires.

* L' `msg` alerte imprimera le texte `GET on wire`.
* Le `flow:established, to_server`: Détermine que le paquet du client au serveur doit correspondre (Les poignées de main : paquet SYN-ACK).
* Le `content`: « GET » indique à Suricata de rechercher le mot GET dans `http.methodle` paquet.
* Le `sid:12345` : Valeur numérique unique qui identifie la règle.
* Le `rev:3` symbole indique la version de la signature, utilisée pour identifier cette version.
2. Déclencher une règle personnalisée dans Suricata.
* Lister les fichiers du `/var/log/suricata` dossier : `ls -l /var/log/suricata`. Pour cette tâche, aucun fichier ne sera trouvé. 

![chrome_cZ26BKgmAo](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/0ad29868-693c-4d87-afd8-5a4deffcd37d)

* Nous exécutons Suricata en utilisant `custom.rules`et `sample.pcap`: `sudo suricata -r sample.pcap -S custom.rules -k none`.
Cette `-r sample.pcap` option spécifie un fichier d'entrée pour simuler le trafic réseau. Dans ce cas, il s'agit du fichier sample.pcap.
Cette `-S custom.rules` option indique à Suricata d'utiliser les règles définies dans le fichier `custom.rules`.
Cette `-k none` option indique à Suricata de désactiver tous les contrôles de somme de contrôle.

![chrome_T7TLuD7CeL](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/2372e192-2be1-48fd-9e1d-e4b7b10c34d2)

* Énumérez à nouveau les fichiers du `/var/log/suricatadossier` : `ls -l /var/log/suricata`.

![chrome_LDJhBLOBkx](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/62961a88-2616-4f53-8adc-1d3d4d51adf8)

* Afficher `fast.log`: `cat /var/log/suricata/fast.log`

![chrome_GCOEhLYHp9](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/52c12462-450d-4f66-bcdf-669236ab5e88)

Ici, chaque ligne correspond à une alerte générée par Suricata lors du traitement d'un paquet répondant aux conditions d'une règle de génération d'alerte. Chaque ligne comprend la règle ayant déclenché l'alerte, la source, la destination et le sens du trafic.

3. Examiner eve.jsonle résultat.
* Utilisez la commande cat pour afficher les entrées du `eve.jsonfichier` : `cat /var/log/suricata/eve.json`. Le format des données sera au format JSON. 

![chrome_r3t4Hi4QtK](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/11037f36-0dd3-4096-92a3-5460ab42dbf4)

* Affichons les entrées dans un format amélioré : `jq . /var/log/suricata/eve/json | less`.

![chrome_9a3WCOAcTe](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/775c44db-f4c1-4bc9-8d02-b6ebb2de9fc0)

* Extraire les données d'événements spécifiques du  `eve.json` fichier: `jq -c "[.timestamp,.flow_id,.alert.signature,.proto,.dest_ip]" /var/log/suricata/eve.json`.
![chrome_BSvLHl2Ja8](https://github.com/Kwangsa19/Ketmanto-Cybersecurity-Portfolio/assets/135963482/7e921312-894c-409f-b606-1cf5facec14b)

> Appuyer sur Q pour quitter `less` commande et revenir à l'invite de commande.

4. Plusieurs choses à trouver dans le eve.json:
* La valeur de la gravité de la première alerte renvoyée par la `jq` commande est de 3.
* L'adresse IP de destination indiquée pour le dernier événement du `eve.jsonfichier` est `142.250.1.102`.
La signature d'alerte pour la première entrée dans le `eve.json` est `GET on WIRE`.
